# Setup SuiteCloud CLI for GitHub Actions

## Prerequisites

- [SuiteCloud CLI for Node.js](https://www.npmjs.com/package/@oracle/suitecloud-cli)

## 1. Enable Features

- Go to **Setup** → **Company** → **Enable Features** → **SuiteCloud**
- Enable:
  - **Client SuiteScript**
  - **Server SuiteScript**
  - **OAuth 2.0**
  - **Suitecloud Development Framework (SDF)**

## 2. Create Certificate

1. Create Certificate

```bash
openssl req -new -x509 -newkey rsa:4096 -sha256 \
-sigopt rsa_padding_mode:pss \
-sigopt rsa_pss_saltlen:64 \
-keyout suitecloud_key.pem \
-out suitecloud_cert.pem \
-nodes
```

> [!NOTE]
> Keep `suitecloud_cert.pem` and `suitecloud_key.pem` handy for next steps.

## 3. Upload Certificate

- Go to **Setup** → **Integration** → **OAuth 2.0 Client Credentials (M2M) Setup**
- Create New:
  - Entity: Administrator (or specific user)
  - Role: Administrator
  - Application: SuiteCloud Development Integration
  - Certificate: Upload `public.pem`
  - Save
- Copy **Certificate ID**

> [!NOTE]
> Keep `Certificate ID` handy for next steps.

## 4. Set Environment Variables

```bash
export SUITECLOUD_ACCOUNT=          # NetSuite Account ID (e.g., 1234567_SB1)
export SUITECLOUD_AUTHID=           # Can be any identifier (e.g. ci)
export SUITECLOUD_CERTIFICATE_ID=   # Certificate ID
export SUITECLOUD_PRIVATE_KEY_PATH= # Path to `suitecloud_key.pem`

export SUITECLOUD_CI_PASSKEY=       # 32-100 alphanumeric password used by SuiteCloud CLI to generate the ~/.suitecloud-sdk/credentials_ci.p12 file
```

> [!NOTE]
> Keep the `SUITECLOUD_CI_PASSKEY`

## 5. Run the SuiteCloud CLI Setup Command

```bash
suitecloud account:setup:ci \
--account $SUITECLOUD_ACCOUNT \
--authid $SUITECLOUD_AUTHID \
--certificateid $SUITECLOUD_CERTIFICATE_ID \
--privatekeypath $SUITECLOUD_PRIVATE_KEY_PATH
```

> [!NOTE]
> Keep the `~/.suitecloud-sdk/credentials_ci.p12` file handy. This file will be generated by SuiteCloud CLI after running the above command.

## 6. Add the following scripts and dependencies to your NetSuite project `package.json`

```json
{
  "scripts": {
    "suitecloud:project:validate": "suitecloud project:validate --server"
    "suitecloud:account:setup:ci": "suitecloud account:setup:ci --account $SUITECLOUD_ACCOUNT --authid $SUITECLOUD_AUTHID --certificateid $SUITECLOUD_CERTIFICATE_ID --privatekeypath $SUITECLOUD_PRIVATE_KEY_PATH"
  },
  "devDependencies": {
    "@oracle/suitecloud-cli": "^3.1.2"
  }
}
```

## Create GHA Build Workflow

```yaml
name: Build

on: pull_request

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest
    environment: ${{ github.base_ref == 'main' && 'production' || 'sandbox' }}
    env:
      SUITECLOUD_ACCOUNT: ${{ secrets.SUITECLOUD_ACCOUNT }}
      SUITECLOUD_AUTHID: ${{ secrets.SUITECLOUD_AUTHID }}
      SUITECLOUD_CERTIFICATE_ID: ${{ secrets.SUITECLOUD_CERTIFICATE_ID }}
      SUITECLOUD_PRIVATE_KEY_PATH: ${{ secrets.SUITECLOUD_PRIVATE_KEY_PATH }}
      SUITECLOUD_CI_PASSKEY: ${{ secrets.SUITECLOUD_CI_PASSKEY }}
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: "22.x"
          cache: "npm"

      - name: Install dependencies
        run: npm ci

      - name: SuiteCloud Setup Account
        run: npm run suitecloud:account:setup:ci

      - name: SuiteCloud Validate Project
        env:
          SUITECLOUD_CI: 1
        run: npm run suitecloud:project:validate
```

## 7. Create GHA Deploy Workflow

```yaml
name: Deploy

on:
  workflow_dispatch:
    inputs:
      environment:
        description: "Select the deployment environment"
        required: true
        default: "sandbox"
        type: choice
        options:
          - sandbox
          - production

jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest
    environment: ${{ inputs.environment }}
    env:
      SUITECLOUD_ACCOUNT: ${{ secrets.SUITECLOUD_ACCOUNT }}
      SUITECLOUD_AUTHID: ${{ secrets.SUITECLOUD_AUTHID }}
      SUITECLOUD_CERTIFICATE_ID: ${{ secrets.SUITECLOUD_CERTIFICATE_ID }}
      SUITECLOUD_PRIVATE_KEY_PATH: ${{ secrets.SUITECLOUD_PRIVATE_KEY_PATH }}
      SUITECLOUD_CI_PASSKEY: ${{ secrets.SUITECLOUD_CI_PASSKEY }}
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: "22.x"
          cache: "npm"

      - name: Install dependencies
        run: npm ci

      - name: SuiteCloud Setup Account
        run: npm run suitecloud:account:setup:ci

      - name: SuiteCloud Deploy Project
        env:
          SUITECLOUD_CI: 1
        run: npm run suitecloud:project:deploy
```
